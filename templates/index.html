<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RAG System</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#f5f5f5}
.container{max-width:1400px;margin:0 auto;padding:20px}
header{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:30px;border-radius:10px;margin-bottom:20px}
h1{font-size:2em;margin-bottom:10px}
.main-content{display:grid;grid-template-columns:350px 1fr;gap:20px}
.sidebar,.chat-area{background:white;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
.section-title{font-size:1.2em;margin-bottom:15px;color:#333;font-weight:600}
.upload-area{border:2px dashed #667eea;border-radius:8px;padding:20px;text-align:center;margin-bottom:20px;cursor:pointer}
.upload-area:hover{background:#f8f9ff}
.upload-area input{display:none}
.btn{padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-size:14px}
.btn-primary{background:#667eea;color:white}
.btn-primary:hover{background:#5568d3}
.btn-secondary{background:#6c757d;color:white}
.status{padding:10px;border-radius:5px;margin:10px 0;display:none}
.status.success{background:#d4edda;color:#155724}
.status.error{background:#f8d7da;color:#721c24}
.chat-box{height:500px;overflow-y:auto;border:1px solid #e0e0e0;border-radius:8px;padding:20px;margin-bottom:15px;background:#fafafa}
.message{margin-bottom:20px;padding:15px;border-radius:10px}
.message.user{background:linear-gradient(135deg,#667eea,#764ba2);color:white;margin-left:15%}
.message.bot{background:white;color:#333;margin-right:15%;border:1px solid #e0e0e0}
.message-label{font-size:0.85em;opacity:0.8;margin-bottom:8px;font-weight:600}
.message-content{line-height:1.6}
.message.bot h2{font-size:1.3em;margin:15px 0 10px 0;color:#333;border-bottom:2px solid #667eea;padding-bottom:5px}
.message.bot h3{font-size:1.1em;margin:12px 0 8px 0;color:#555}
.message.bot p{margin:10px 0}
.message.bot ul,.message.bot ol{margin:10px 0;padding-left:25px}
.message.bot li{margin:5px 0}
.message.bot strong{color:#667eea;font-weight:600}
.message.bot blockquote{border-left:3px solid #667eea;padding-left:15px;margin:10px 0;color:#666}
.metadata{margin-top:12px;padding-top:12px;border-top:1px solid #e0e0e0;font-size:0.85em;color:#666}
.input-area{display:flex;gap:10px}
.input-area input{flex:1;padding:12px;border:1px solid #ddd;border-radius:5px}
.examples{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
.example-btn{padding:8px 15px;background:#f0f0f0;border:1px solid #ddd;border-radius:5px;cursor:pointer;font-size:13px}
.example-btn:hover{background:#667eea;color:white}
.stats-box{background:#f8f9fa;padding:15px;border-radius:8px;margin-top:15px;font-size:14px}
.loader{border:3px solid #f3f3f3;border-top:3px solid #667eea;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;margin:20px auto;display:none}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="container">
<header><h1>ğŸš€ RAG System</h1><p>Upload PDF documents and ask questions using AI</p></header>
<div class="main-content">
<div class="sidebar">
<div class="section-title">ğŸ“„ Upload PDF</div>
<div class="upload-area" id="uploadArea"><p>ğŸ“ Click to upload PDF</p><input type="file" id="fileInput" accept=".pdf"></div>
<div id="uploadStatus" class="status"></div>
<div id="uploadLoader" class="loader"></div>
<div class="section-title" style="margin-top:20px">ğŸ“Š System</div>
<button class="btn btn-primary" style="width:100%;margin-bottom:10px" id="statsBtn">Show Statistics</button>
<button class="btn btn-secondary" style="width:100%" id="clearBtn">Clear Conversation</button>
<div id="statsBox" class="stats-box" style="display:none"></div>
</div>
<div class="chat-area">
<div class="section-title">ğŸ’¬ Ask Questions</div>
<div id="chatBox" class="chat-box"></div>
<div id="chatLoader" class="loader"></div>
<div class="input-area"><input type="text" id="questionInput" placeholder="Ask a question..."><button class="btn btn-primary" id="askBtn">Ask</button></div>
<div class="section-title" style="margin-top:15px;font-size:1em">ğŸ’¡ Examples</div>
<div class="examples">
<button class="example-btn" data-q="Summarize the main content">ğŸ“– Summarize</button>
<button class="example-btn" data-q="Show me any tables">ğŸ“Š Tables</button>
<button class="example-btn" data-q="What images are there?">ğŸ–¼ï¸ Images</button>
</div>
</div>
</div>
</div>
<script>
marked.setOptions({breaks:true,gfm:true});

document.getElementById('uploadArea').addEventListener('click', function() {
    document.getElementById('fileInput').click();
});

document.getElementById('fileInput').addEventListener('change', function() {
    const file = this.files[0];
    if (!file) return;
    const form = new FormData();
    form.append('file', file);
    document.getElementById('uploadLoader').style.display = 'block';
    fetch('/upload', {method: 'POST', body: form})
        .then(r => r.json())
        .then(d => {
            document.getElementById('uploadLoader').style.display = 'none';
            const msg = d.success ? 
                'âœ… ' + d.message + '\nText: ' + d.statistics.text_chunks + ', Tables: ' + d.statistics.table_chunks + ', Images: ' + d.statistics.image_chunks :
                d.message;
            showStatus('uploadStatus', msg, d.success);
            this.value = '';
        })
        .catch(e => {
            document.getElementById('uploadLoader').style.display = 'none';
            showStatus('uploadStatus', 'Error: ' + e.message, false);
        });
});

document.getElementById('askBtn').addEventListener('click', askQuestion);
document.getElementById('questionInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') askQuestion();
});

document.getElementById('clearBtn').addEventListener('click', function() {
    fetch('/clear', {method: 'POST'})
        .then(() => {
            document.getElementById('chatBox').innerHTML = '';
            showStatus('uploadStatus', 'Conversation cleared', true);
        });
});

document.getElementById('statsBtn').addEventListener('click', function() {
    fetch('/stats')
        .then(r => r.json())
        .then(d => {
            if (d.success) {
                let html = '<strong>ğŸ“Š Vector Store:</strong><br>';
                for (let k in d.stats.vector_store) html += k + ': ' + d.stats.vector_store[k] + '<br>';
                html += '<br><strong>ğŸ¤– Models:</strong><br>';
                for (let k in d.stats.models) html += k + ': ' + d.stats.models[k] + '<br>';
                document.getElementById('statsBox').innerHTML = html;
                document.getElementById('statsBox').style.display = 'block';
            }
        });
});

document.querySelectorAll('.example-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.getElementById('questionInput').value = this.getAttribute('data-q');
    });
});

function askQuestion() {
    const input = document.getElementById('questionInput');
    const q = input.value.trim();
    if (!q) return;
    addMessage('user', q);
    input.value = '';
    document.getElementById('chatLoader').style.display = 'block';
    fetch('/ask', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({question: q})
    })
        .then(r => r.json())
        .then(d => {
            document.getElementById('chatLoader').style.display = 'none';
            if (d.success) {
                addMessage('bot', d.answer, d.metadata);
            } else {
                addMessage('bot', 'âŒ ' + d.message);
            }
        })
        .catch(e => {
            document.getElementById('chatLoader').style.display = 'none';
            addMessage('bot', 'âŒ Error: ' + e.message);
        });
}

function addMessage(type, text, meta) {
    const box = document.getElementById('chatBox');
    const msg = document.createElement('div');
    msg.className = 'message ' + type;
    let html = '<div class="message-label">' + (type === 'user' ? 'ğŸ§‘ You' : 'ğŸ¤– Assistant') + '</div>';
    if (type === 'bot') {
        html += '<div class="message-content">' + marked.parse(text) + '</div>';
        if (meta && meta.sources_used > 0) {
            html += '<div class="metadata">ğŸ“š Sources: ' + meta.sources_used + ' | ğŸ¯ Confidence: ' + (meta.confidence * 100).toFixed(0) + '% | ğŸ” Type: ' + meta.query_type + '</div>';
        }
    } else {
        html += '<div class="message-content">' + text + '</div>';
    }
    msg.innerHTML = html;
    box.appendChild(msg);
    box.scrollTop = box.scrollHeight;
}

function showStatus(id, msg, ok) {
    const el = document.getElementById(id);
    el.textContent = msg;
    el.className = 'status ' + (ok ? 'success' : 'error');
    el.style.display = 'block';
    setTimeout(() => el.style.display = 'none', 5000);
}
</script>
</body>
</html>